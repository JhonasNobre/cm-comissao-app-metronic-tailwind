<div class="kt-container-fluid">
    <div class="flex flex-wrap items-center lg:items-end justify-between gap-5 pb-7.5">
        <div class="flex flex-col justify-center gap-2">
            <h1 class="text-xl font-medium leading-none text-mono">
                {{ isEditMode ? 'Editar Usuário' : 'Novo Usuário' }}
            </h1>
        </div>
    </div>
</div>

<div class="kt-container-fluid">
    <div class="grid gap-5 lg:gap-7.5">
        <div class="kt-card">
            <div class="kt-card-body">
                <form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-5">
                    <p-toast></p-toast>

                    <p-tabs value="0">
                        <p-tablist>
                            <p-tab value="0">Dados do Usuário</p-tab>
                            <p-tab value="1">Liberação de Acessos</p-tab>
                            <p-tab value="2">Horário de Trabalho</p-tab>
                        </p-tablist>

                        <p-tabpanels>
                            <!-- Aba 1: Dados do Usuário -->
                            <p-tabpanel value="0">
                                <app-user-general-tab [form]="form" [teams]="teams" [isManager]="isManager"
                                    [isEditMode]="isEditMode" [accessProfiles]="accessProfiles"
                                    [userRoleOptions]="userRoleOptions" [keycloakRoleOptions]="keycloakRoleOptions">
                                </app-user-general-tab>
                            </p-tabpanel>

                            <!-- Aba 2: Liberação de Acessos -->
                            <p-tabpanel value="1">
                                <app-user-access-tab [form]="form" [companies]="companies" [resources]="resources"
                                    [permissions]="currentPermissions">
                                </app-user-access-tab>
                            </p-tabpanel>

                            <!-- Aba 3: Horário de Trabalho -->
                            <p-tabpanel value="2">
                                <app-user-schedule-tab [parentForm]="form" [diasSemanaOptions]="diasSemanaOptions">
                                </app-user-schedule-tab>
                            </p-tabpanel>
                        </p-tabpanels>
                    </p-tabs>

                    <!-- Ações -->
                    <div class="flex justify-end gap-3 pt-5 mt-4 border-t border-gray-200">
                        <button *ngIf="isEditMode && !isInactive && !isProtected" type="button"
                            class="kt-btn kt-btn-danger mr-auto" (click)="onInactivate()">
                            <i class="ki-filled ki-cross-circle"></i>
                            Inativar Usuário
                        </button>

                        <button *ngIf="isEditMode && isInactive" type="button" class="kt-btn kt-btn-success mr-auto"
                            (click)="onReactivate()">
                            <i class="ki-filled ki-check-circle"></i>
                            Habilitar Usuário
                        </button>

                        <button type="button" class="kt-btn kt-btn-light" (click)="onCancel()">
                            Cancelar
                        </button>
                        <button type="submit" class="kt-btn kt-btn-primary" [disabled]="form.invalid || loading">
                            <i *ngIf="!loading" class="ki-filled ki-check"></i>
                            <span *ngIf="loading"
                                class="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full mr-2"></span>
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>