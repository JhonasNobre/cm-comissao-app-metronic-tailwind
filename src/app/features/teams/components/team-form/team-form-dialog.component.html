<form [formGroup]="form" class="flex flex-col h-full">
    <!-- Área de conteúdo rolável -->
    <div class="flex-1 overflow-y-auto pr-2 flex flex-col gap-5">

        <!-- Nome da Equipe -->
        <div class="flex flex-col gap-2">
            <label for="nome" class="font-semibold text-gray-700">{{ 'teams.form.name' | transloco }}</label>
            <input pInputText id="nome" formControlName="nome" placeholder="{{ 'teams.form.name' | transloco }}"
                class="w-full" />
            <small *ngIf="form.get('nome')?.invalid && form.get('nome')?.touched" class="text-red-500">
                {{ 'general.validation.required' | transloco }}
            </small>
        </div>

        <!-- Perfil de Acesso -->
        <div class="flex flex-col gap-2">
            <label for="perfil" class="font-semibold text-gray-700">{{ 'teams.form.access_profile' | transloco
                }}</label>
            <p-select [options]="accessProfiles" formControlName="perfilAcessoId" optionLabel="nome" optionValue="id"
                placeholder="{{ 'teams.form.select_profile' | transloco }}" styleClass="w-full"
                [style]="{'width':'100%'}" appendTo="body"></p-select>
        </div>

        <p-divider></p-divider>

        <!-- Checkbox de Restrição de Horário -->
        <div class="flex items-center gap-2">
            <p-checkbox [binary]="true" inputId="restricao" [ngModel]="hasRestricaoHorario"
                (onChange)="toggleRestricaoHorario($event)" [ngModelOptions]="{standalone: true}"></p-checkbox>
            <label for="restricao" class="font-semibold cursor-pointer select-none text-gray-700"
                (click)="hasRestricaoHorario = !hasRestricaoHorario; toggleRestricaoHorario({checked: hasRestricaoHorario})">
                {{ 'teams.form.time_restriction' | transloco }}
            </label>
        </div>

        <!-- Painel de Configuração de Restrição -->
        <div *ngIf="hasRestricaoHorario" formGroupName="restricaoHorario"
            class="flex flex-col gap-4 p-4 border border-gray-200 rounded-lg bg-gray-50">

            <!-- Bloqueio em Feriados -->
            <div class="flex items-center gap-2">
                <p-checkbox formControlName="bloquearEmFeriadosNacionais" [binary]="true"
                    inputId="feriados"></p-checkbox>
                <label for="feriados" class="cursor-pointer select-none">{{ 'teams.form.block_holidays' | transloco
                    }}</label>
            </div>

            <!-- UF e Código IBGE -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="flex flex-col gap-2">
                    <label for="uf" class="text-sm font-medium text-gray-600">{{ 'teams.form.holidays_uf' | transloco
                        }}</label>
                    <input pInputText id="uf" formControlName="ufFeriados" placeholder="Ex: SP" maxlength="2"
                        class="w-full" />
                </div>
                <div class="flex flex-col gap-2">
                    <label for="ibge" class="text-sm font-medium text-gray-600">{{ 'teams.form.ibge_code' | transloco
                        }}</label>
                    <input pInputText id="ibge" formControlName="codigoIbgeMunicipio" placeholder="Ex: 3550308"
                        class="w-full" />
                </div>
            </div>

            <!-- Lista de Horários -->
            <div class="flex flex-col gap-3 mt-2">
                <div class="flex justify-between items-center">
                    <label class="font-semibold text-gray-700">{{ 'teams.form.allowed_times' | transloco }}</label>
                    <button type="button" class="kt-btn kt-btn-sm kt-btn-light-primary" (click)="addHorario()">
                        <i class="ki-filled ki-plus"></i>
                        {{ 'teams.form.add_time' | transloco }}
                    </button>
                </div>

                <div formArrayName="horarios" class="flex flex-col gap-3">
                    <div *ngFor="let item of horarios.controls; let i = index" [formGroupName]="i"
                        class="flex flex-wrap md:flex-nowrap gap-2 items-end bg-white p-3 rounded border border-gray-200 shadow-sm">

                        <!-- Dia da Semana -->
                        <div class="w-full md:flex-1">
                            <label class="text-xs text-gray-500 block mb-1">{{ 'teams.form.day' | transloco }}</label>
                            <p-select [options]="diasSemanaOptions" formControlName="diaSemana" optionLabel="label"
                                optionValue="value" styleClass="w-full" [style]="{'width':'100%'}"
                                appendTo="body"></p-select>
                        </div>

                        <!-- Hora Início -->
                        <div class="w-1/2 md:w-28">
                            <label class="text-xs text-gray-500 block mb-1">{{ 'teams.form.start' | transloco }}</label>
                            <p-inputMask mask="99:99" formControlName="horaInicio" placeholder="00:00"
                                styleClass="w-full"></p-inputMask>
                        </div>

                        <!-- Hora Fim -->
                        <div class="w-1/2 md:w-28">
                            <label class="text-xs text-gray-500 block mb-1">{{ 'teams.form.end' | transloco }}</label>
                            <p-inputMask mask="99:99" formControlName="horaFim" placeholder="00:00"
                                styleClass="w-full"></p-inputMask>
                        </div>

                        <!-- Botão Remover -->
                        <button type="button" class="btn btn-icon btn-light-danger" pTooltip="Remover"
                            tooltipPosition="top" (click)="removeHorario(i)">
                            <i class="ki-filled ki-trash"></i>
                        </button>
                    </div>

                    <div *ngIf="horarios.controls.length === 0" class="text-center p-4 text-gray-500 text-sm italic">
                        Nenhum horário configurado. Adicione um horário para permitir acesso.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rodapé com Ações (Fixo) -->
    <div class="flex justify-end gap-3 pt-5 mt-4 border-t border-gray-200">
        <button type="button" class="kt-btn kt-btn-light" (click)="onCancel()">
            {{ 'SHARED.COMMON.CANCEL' | transloco }}
        </button>
        <button type="button" class="kt-btn kt-btn-primary" (click)="onSubmit()">
            <i class="ki-filled ki-check"></i>
            {{ 'general.singular.save' | transloco }}
        </button>
    </div>
</form>