<div class="flex flex-col gap-6 mt-4">
    <div class="flex flex-col gap-4">
        <h3 class="font-bold text-gray-800">Permissões</h3>
        <p class="text-gray-500 text-sm mb-2">
            Selecione as telas que o usuário terá acesso e adicione ações que ele poderá realizar:
        </p>

        <!-- PrimeNG v20+ Accordion Syntax - Lista de Recursos Individuais -->
        <p-accordion [value]="activeIndices" [multiple]="true" styleClass="w-full">
            <p-accordion-panel *ngFor="let res of resources; let i = index" [value]="i">
                <p-accordion-header>
                    <div class="flex justify-between items-center w-full pr-4">
                        <div class="flex flex-col gap-0">
                            <span class="font-bold text-blue-600">{{ res.nome }}</span>
                            <span class="text-xs text-gray-500 italic" *ngIf="res.descricao">{{ res.descricao }}</span>
                        </div>
                        <span
                            class="text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors pointer-events-none">
                            {{ isOpen(i) ? 'Mostrar menos' : 'Mostrar mais' }}
                        </span>
                    </div>
                </p-accordion-header>
                <p-accordion-content>
                    <div class="flex flex-col gap-6 p-4">
                        <ng-container *ngIf="getPermissionRow(res.id) as row">
                            <!-- Operações -->
                            <div class="flex flex-col gap-2">
                                <label class="text-xs font-semibold text-gray-600 uppercase">Operações</label>
                                <div class="flex flex-wrap gap-2">
                                    <!-- Create -->
                                    <div class="flex items-center gap-2">
                                        <p-checkbox [(ngModel)]="row.canCreate" [binary]="true"
                                            (onChange)="onPermissionChange()"
                                            [inputId]="'criar-' + res.id"></p-checkbox>
                                        <label [for]="'criar-' + res.id"
                                            class="cursor-pointer select-none text-sm">Adicionar</label>
                                    </div>
                                    <!-- Update -->
                                    <div class="flex items-center gap-2 ml-4">
                                        <p-checkbox [(ngModel)]="row.canUpdate" [binary]="true"
                                            (onChange)="onPermissionChange()"
                                            [inputId]="'atualizar-' + res.id"></p-checkbox>
                                        <label [for]="'atualizar-' + res.id"
                                            class="cursor-pointer select-none text-sm">Alterar</label>
                                    </div>
                                    <!-- Approve -->
                                    <div class="flex items-center gap-2 ml-4">
                                        <p-checkbox [(ngModel)]="row.canApprove" [binary]="true"
                                            (onChange)="onPermissionChange()"
                                            [inputId]="'aprovar-' + res.id"></p-checkbox>
                                        <label [for]="'aprovar-' + res.id"
                                            class="cursor-pointer select-none text-sm">Aprovar</label>
                                    </div>
                                    <!-- Read -->
                                    <div class="flex items-center gap-2 ml-4">
                                        <p-checkbox [(ngModel)]="row.canRead" [binary]="true"
                                            (onChange)="onPermissionChange()" [inputId]="'ler-' + res.id"></p-checkbox>
                                        <label [for]="'ler-' + res.id"
                                            class="cursor-pointer select-none text-sm">Consultar</label>
                                    </div>
                                    <!-- Print -->
                                    <div class="flex items-center gap-2 ml-4">
                                        <p-checkbox [(ngModel)]="row.canPrint" [binary]="true"
                                            (onChange)="onPermissionChange()"
                                            [inputId]="'imprimir-' + res.id"></p-checkbox>
                                        <label [for]="'imprimir-' + res.id"
                                            class="cursor-pointer select-none text-sm">Imprimir</label>
                                    </div>
                                    <!-- Delete -->
                                    <div class="flex items-center gap-2 ml-4">
                                        <p-checkbox [(ngModel)]="row.canDelete" [binary]="true"
                                            (onChange)="onPermissionChange()"
                                            [inputId]="'excluir-' + res.id"></p-checkbox>
                                        <label [for]="'excluir-' + res.id"
                                            class="cursor-pointer select-none text-sm">Remover</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Visualização (Scope) -->
                            <div class="flex flex-col gap-2 mt-2">
                                <label class="text-xs font-semibold text-gray-600 uppercase">Visualização</label>
                                <div class="flex flex-wrap gap-4">
                                    <div class="flex items-center gap-2">
                                        <input type="radio" [(ngModel)]="row.scope" value="TODOS"
                                            (change)="onPermissionChange()" [id]="'todos-' + res.id"
                                            name="scope-{{ res.id }}" />
                                        <label [for]="'todos-' + res.id"
                                            class="cursor-pointer select-none text-sm">Todos os Dados</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="radio" [(ngModel)]="row.scope" value="DADOS_USUARIO"
                                            (change)="onPermissionChange()" [id]="'usuario-' + res.id"
                                            name="scope-{{ res.id }}" />
                                        <label [for]="'usuario-' + res.id"
                                            class="cursor-pointer select-none text-sm">Dados do Usuário</label>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <input type="radio" [(ngModel)]="row.scope" value="DADOS_EQUIPE"
                                            (change)="onPermissionChange()" [id]="'equipe-' + res.id"
                                            name="scope-{{ res.id }}" />
                                        <label [for]="'equipe-' + res.id"
                                            class="cursor-pointer select-none text-sm">Dados da Equipe</label>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </p-accordion-content>
            </p-accordion-panel>
        </p-accordion>
    </div>
</div>