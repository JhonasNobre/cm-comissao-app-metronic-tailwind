<div class="kt-container-fluid" *ngIf="venda">
    <!-- Header -->
    <div class="flex flex-wrap items-center justify-between gap-5 mb-5 border-b pb-5">
        <div class="flex flex-col gap-1">
            <div class="flex items-center gap-3">
                <button pButton pRipple type="button" label="Voltar" icon="pi pi-arrow-left"
                    class="p-button-text p-button-secondary" (click)="voltar()"></button>
                <div class="flex flex-col">
                    <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-0">
                        Detalhes da Pendência
                    </h1>
                    <span class="text-sm text-gray-500">Vendas / Pendentes / {{venda.codigoVendaLegado}}</span>
                </div>
                <p-tag [value]="venda.statusGeral" [severity]="venda.statusGeral === 'Liberado' ? 'success' : 'warn'"
                    class="ml-2"></p-tag>
            </div>
        </div>
    </div>

    <!-- Info Basic -->
    <div class="card card-custom gutter-b mb-5 p-5">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="flex flex-col">
                <span class="text-xs text-gray-500 uppercase font-bold">Cliente</span>
                <span class="text-base font-medium">{{venda.nomeCliente || 'N/A'}}</span>
                <span class="text-sm text-gray-400">{{venda.cpfCliente || 'Sem CPF'}}</span>
            </div>
            <div class="flex flex-col">
                <span class="text-xs text-gray-500 uppercase font-bold">Empreendimento</span>
                <span class="text-base font-medium">{{venda.empreendimento || 'N/A'}}</span>
                <span class="text-sm text-gray-400">Unidade: {{venda.unidade || 'N/A'}}</span>
            </div>
            <div class="flex flex-col">
                <span class="text-xs text-gray-500 uppercase font-bold">Data da Venda</span>
                <span class="text-base font-medium">{{venda.dataVenda | date:'dd/MM/yyyy'}}</span>
            </div>
        </div>
    </div>

    <!-- Abas -->
    <p-tabs [value]="0">
        <p-tablist>
            <p-tab value="0">
                <i class="pi pi-exclamation-triangle mr-2"></i>Pendências Identificadas
            </p-tab>
            <p-tab value="1">
                <i class="pi pi-file mr-2"></i>Documentos Enviados
            </p-tab>
        </p-tablist>

        <p-tabpanels>
            <!-- Tab: Pendências -->
            <p-tabpanel value="0">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border mt-4">
                    <p-table [value]="venda.pendencias" styleClass="p-datatable-sm">
                        <ng-template pTemplate="header">
                            <tr class="text-xs text-gray-400 uppercase bg-gray-50">
                                <th style="width: 200px">Tipo</th>
                                <th>Descrição da Pendência</th>
                                <th style="width: 100px" class="text-center">Bloqueia</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-p>
                            <tr class="text-sm border-b">
                                <td class="font-bold">{{p.tipo}}</td>
                                <td>{{p.descricao}}</td>
                                <td class="text-center">
                                    <i class="pi"
                                        [ngClass]="p.bloqueante ? 'pi-lock text-red-500' : 'pi-info-circle text-blue-500'"></i>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="3" class="text-center p-8 text-gray-500 font-medium">
                                    <i class="pi pi-check-circle text-green-500 text-3xl mb-3 block"></i>
                                    Nenhuma pendência encontrada para esta venda.
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabpanel>

            <!-- Tab: Documentos -->
            <p-tabpanel value="1">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border mt-4">
                    <p-table [value]="venda.documentos" styleClass="p-datatable-sm">
                        <ng-template pTemplate="header">
                            <tr class="text-xs text-gray-400 uppercase bg-gray-50">
                                <th>Tipo do Documento</th>
                                <th>Status</th>
                                <th style="width: 150px" class="text-right">Ação</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-doc>
                            <tr class="text-sm border-b">
                                <td>
                                    <div class="flex items-center gap-2">
                                        <i class="pi pi-file-pdf text-red-500"></i>
                                        <span>{{doc.tipo}}</span>
                                    </div>
                                </td>
                                <td>
                                    <p-tag [value]="doc.status"
                                        [severity]="doc.status === 'Aprovado' ? 'success' : 'info'"></p-tag>
                                </td>
                                <td class="text-right">
                                    <button pButton icon="pi pi-external-link" label="Visualizar"
                                        class="p-button-text p-button-sm" (click)="abrirDocumento(doc.url)">
                                    </button>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="3" class="text-center p-8 text-gray-500">Nenhum documento anexado.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </p-tabpanel>
        </p-tabpanels>
    </p-tabs>
</div>

<p-toast></p-toast>
<div *ngIf="loading" class="flex justify-center p-20">
    <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
</div>